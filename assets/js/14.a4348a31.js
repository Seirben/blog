(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{332:function(e,n,t){"use strict";t.r(n);var a=t(33),s=Object(a.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"node发送邮件功能的实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node发送邮件功能的实现"}},[e._v("#")]),e._v(" node发送邮件功能的实现")]),e._v(" "),t("blockquote",[t("p",[e._v("很多项目都会有登录功能,登录又分为短信验证码登录和邮箱验证码登录.两者都需要服务端发送随机验证码给客户端,今天我们来实现一个简单的发送邮件的功能吧")])]),e._v(" "),t("h2",{attrs:{id:"初始化项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化项目"}},[e._v("#")]),e._v(" 初始化项目")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mkdir node-mail && cd $_\nyarn init -y\n")])])]),t("p",[e._v("首先,我们创建一个项目然后进入此项目,并且进行初始化操作")]),e._v(" "),t("h2",{attrs:{id:"安装插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装插件"}},[e._v("#")]),e._v(" 安装插件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yarn add nodemailer\n")])])]),t("p",[e._v("安装插件,具体插件的详细说明"),t("a",{attrs:{href:"https://nodemailer.com/about/",target:"_blank",rel:"noopener noreferrer"}},[e._v("看这里"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"编写代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写代码"}},[e._v("#")]),e._v(" 编写代码")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\"use strict\";\nconst nodemailer = require('nodemailer')\nconst fs = require('fs')\nconst path = require('path')\n\nconst transporter = nodemailer.createTransport({\n  service:'163',  //使用的邮箱类型,全部类型可以查看官网\n  secureConnection:true,  // 使用了SSL\n  auth:{\n    user:'zhangsan_test@163.com',\n    pass:'xxx',  // 授权码,不是密码,一般可以通过发送短信验证码来获取,且只展示一次,记得保存好\n  }\n})\n\nlet code = Math.random().toString().substr(2, 6)  //随机生成6位验证码\n\nlet mailOptions = {\n  from:'zhangsan_test@163.com',\n  // to:'12345@qq.com',  //邮件接收方,单个邮箱 字符串写法\n  to:['12345@qq.com','12346@qq.com'],  //多个邮箱 数组写法\n  subject:'Hello this is zhangsan from zhejiang',  //主题\n  text:`您的验证码是${code},验证码在10分钟内有效`,  //正文内容,可以是text文本形式,也可以是一个html页面\n  // html:fs.createReadStream(path.resolve(__dirname,'index.html')),  //引用一个html形式,可以在根目录创建一个html文件\n  attachments:[  //附件\n    {\n      filename:'1.png',\n      path:path.resolve(__dirname, 'images/1.png'),\n      cid:\"01\" \n    },\n    {\n      filename:'1.txt',\n      content:'Hello world !!!'\n    },\n    {\n      filename:'2.txt',\n      path:'./2.txt' \n    }\n  ]\n}\n\ntransporter.sendMail(mailOptions, (error, info) =>{\n  console.log({code})\n  if(error){\n    return console.log(error)\n  }\n  console.log(info)\n})\n")])])]),t("p",[t("strong",[e._v("注意:")]),e._v(" html里面是可以写样式的,内联样式和行内样式都是可以的.想要引用图片,若图片较小可以转为base64,图片较大则建议使用对象存储,引用cdn.")]),e._v(" "),t("h2",{attrs:{id:"测试结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试结果"}},[e._v("#")]),e._v(" 测试结果")]),e._v(" "),t("p",[e._v("在终端键入 "),t("code",[e._v("node app.js")]),e._v(" 查看运行结果,若出现下面的日志,则证明我们的邮件已经发送成功了")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("{\n  accepted: [ '12345@qq.com', '12346@qq.com' ],\n  rejected: [],\n  envelopeTime: 726,\n  messageTime: 376,\n  messageSize: 381,\n  response: '250 Mail OK queued as smtp11,xxxx--.4S2 xxxxx',\n  envelope: {\n    from: 'zhangsan_test@163.com',\n    to: [ '12345@qq.com', '12346@qq.com' ]\n  },\n  messageId: '<xxx@163.com>'\n}\n")])])]),t("p",[e._v("自此,一个简单的发送邮件的功能就已经完成了.当然,想要运用到真正的业务当中,还需要很多额外的逻辑判断.比如限制发送频率等.")])])}),[],!1,null,null,null);n.default=s.exports}}]);